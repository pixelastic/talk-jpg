<!doctype html>
<html class="no-js" lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Anatomie d'un JPG</title>
    <meta name="description" content="Remember">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="stylesheet" href="./css/remark.css">
    <link rel="stylesheet" href="./css/table.css">
    <link rel="stylesheet" href="./css/fonts.css">
    <link rel="stylesheet" href="./css/code.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="./favicon.ico">
  </head>

  <body>
    <textarea id="source">
class: full-page, slide-intro
# Anatomie d'un JPG
---
class: content-centered
# Why a talk about JPEG ?
- Webperf is a hot topic for us
- JPEG comes from the 90's
- Still widely used today

---
class: content-centered
# JPEG : historique
- **J**oint **P**hotographic **E**xperts **G**roup produced the standard *Information technology – Digital compression and coding of continuous-tone still images*
- Started in 1986, published in 1992 (approved by ISO and ITU)
- Image compression method
- File format: **J**peg **F**ile **I**nterchange **F**ormat (JFIF)

---
class: content-centered
# Images : >50% du payload
.column-right[
  ![Image payload](./img/img_to_transfer_size.png)

  [source](http://httparchive.org/trends.php?s=All&minlabel=Jun+1+2011&maxlabel=Apr+1+2015#bytesImg&reqImg)
]
<<<<<<< HEAD
[source](http://httparchive.org/trends.php?s=All&minlabel=Jun+1+2011&maxlabel=Apr+1+2015#bytesImg&reqImg)
=======
>>>>>>> update algos

---
class: content-centered
# Sommaire

- Compression
- Metadatas
- Outils

---
class: content-centered

.center[
  ![UI d'export de Gimp](./img/gimp-export.jpg)
]

---
class: content-centered
# Mode naïf

.center[
  ![Example 400x268](./img/example-400.jpg)
]

 

- 400 x 268 = 107 200px
- RGB = 3 bytes
- 321 600 ≠ 111 858 ≠ 9 412

---
class: content-centered
# Une combinaison de méthodes

<<<<<<< HEAD
- Compression sans perte (*lossless*)

    Techniques issues de la théorie de l'information (Shannon, 1948)

    Algèbre linéaire

- Compression avec perte (*lossy*)

    Techniques psychovisuelles
    
    Quantification
=======
### Compression sans perte (lossless)
- Techniques issues de la théorie de l'information 
- Algèbre linéaire

### Compression avec perte (lossy)
- Techniques psychovisuelles
- Quantification
>>>>>>> update algos

---
class: content-centered
# Test 
- Changement d'unités
- Faiblesse de l'œil humain
- Zip classique
- Recherche de redondances
-- Techniques issues de la théorie de l'information (Shannon, 1948)
--- Huffman Coding
--- Differential coding
-- Techniques d'algèbre linéaire
--- Karhunen Loève Transform (KLT)
--- Discrete Cosine Transform
-- Techniques psychovisuelles
--- RGB --> YCrCb
--- Quantification empirique

---
class: content-centered
# Division par blocs de 8x8

.center[
  ![Blocs 8x8](./img/example-400-grid.jpg)
]

 

- Compression sur chaque bloc
- Artefacts visibles à l'œil nu

---
class: content-centered
# Division par blocs de 8x8

<<<<<<< HEAD
.center[
  ![Zoom](./img/example-blocks-zoom.jpg)
]

 

- Teinte dominante par bloc

---
class: content-centered
# Division par blocs de 8x8

.center[
  ![Zoom](./img/example-block-zoom.jpg)
]

 

- Pixels contigus similaires
=======
- 8x8 c'est petit
- Chaque pixel est quasi-identique à son voisin
- Aplats de couleur fréquents sur les photos
- Chaque bloc a une teinte dominante
- Redondance de teinte entre les blocs voisins
- Bon compromis de taille entre localité et performances [à l'époque](http://www.faqs.org/faqs/mpeg-faq/part3/)


---
class: content-centered
## Encodage et décodage

.center[
  ![Diagramme de flux](./img/500px-JPEG_process.svg.png)
]

- Temps de traitement et Optimisations sur l'encodeur
- Décodeur plutôt rapide et standardisé
>>>>>>> update algos

---
class: content-centered
# RGB ➔ YCbCr

- Changement d'unité RGB ➔ YCbCr
- Lossless
- Deux couleurs proches
  - R + G + B changent
  - Seul Y change. G et B restent identiques ou très proches.
- Redondance Cb/Cr.

// TODO: Exemples de couleurs proches avec équivalents RGB et équivalents YCbCR

---
class: content-centered
# Subsampling

- Pixels cote-à-cote, même Cb/Cr
- Merger les pixels. 2 par 2, 4 par 4, par ligne, par colonne
- Moins de valeurs à stocker
- Lossy

// Example d'une même image subsamplée différemment pour montrer la différence
de teinte ?

---
class: content-centered
# Discrete Cosine Tranform

- Sur un bloc complet
- Dur à expliquer, partie la plus couteuse en CPU
- Changement d'unité
- 64 pixels deviennent une somme de 64 vecteurs
- Chaque vecteur est coefficienté
- Chaque bloc possède donc un hash unique
- Quasi-lossless (arrondis)

![DCT](./img/dctjpeg.png)

---
class: content-centered
# DCT côté maths

- Proche de la Discrete Fourier Transform
    
    facile à implémenter abutterfly algorithms
- DCT de type II (propriétés de symétries par extension)
- Bonne approximation de la Karhunen-Loève Transform (ACP)
    pour les processus markovien d'ordre 1


---
class: content-centered
# Quantification

- Premiers vecteurs plus forts
- Derniers vecteurs plus faibles
- Suppression des faibles
- Suppression de ceux jugés (empiriquement) inutile
- Table de quantification différentes selon les algos
- Table stockée dans le JPG
- Lossy

---
class: content-centered
# Compression des zéros

- Vecteurs supprimés = coefficient à zero
- Redondance de zero
- Encode le nombre de zeros pour gagner de la place

---
class: content-centered
# Fin du bloc

- 64px en rgb
- 64px en YCbCr
- Subsampling, merging de pixels
- Somme de vecteurs
- Quantization (œil humain)
- Compression de zeros

Pour chaque bloc.

---
class: content-centered
# Blocs proches

- 8x8 c'est petit
- Blocs proches ont une teinte proche
- On définit le vecteur principal d'un bloc par le delta par rapport au bloc
  précédent

---
class: content-centered
# Huffmann coding

- Image complete
- Recherche de redondance
- Compression par patterns, dictionnaire, symboles

---
class: content-centered
# Conclusion

- Image = Somme des blocs
- Bloc = Somme des pixels
- Reversible
- Mix lossless et lossy
- Implémentations différentes par outil
- Lecture normale ou progressive

---
class: full-page, slide-metadata
# Metadatas

---
class: content-centered
# Trois formats

// TODO : un output d'exiftool

- Exif
- IPTC
- XMP

---
class: content-centered
# EXIF (1995)

- **EX**changeable **I**mage **F**ile
- Lors de la prise de photo
- Informations techniques
- 64kb max, no UTF-8, no timezone

---
class: content-centered
# IPTC (1990)

.center[
  ![IPTC](./img/iptc.gif)
]

 

- **I**nternational **P**ress **T**elecommunications **C**ouncil
- **I**nformation **I**nterchange **M**odel
- Texte, audio, video, images, etc
- Auteur, copyright, description, etc
- Deprecated

---
class: content-centered
# XMP (2001)

.center[
  ![XMP](./img/xmp.png)
]

 

- e**X**tensible **M**etadata **P**latform
- EXIF + IPTC en XML
- Extensible, UTF-8, i18n
- Support faible

---
class: content-centered
# Fragmentation

- Info dupliquée
- Reconciliation
- Support limité
- Tags propriétaires

---
class: content-centered
# Compression

- Suppression aggressive
- Garder auteur, license

 

```shell
jpegtran -optimize -copy none file.jpg
```

---
class: full-page, slide-tools
# Outils

---
class: content-centered
# Outils

// TODO ajouter ces outils directement au fil de la présentation ?

- jpegoptim -m80 --strip-all
- cjpeg-dssim jpegoptim

---
## Sources

http://www.impulseadventure.com/photo/jpeg-compression.html
http://fr.wikipedia.org/wiki/JPEG#D.C3.A9coupage_en_blocs
http://fr.wikipedia.org/wiki/Codage_de_Huffman
http://en.wikipedia.org/wiki/File:JPEG_process.svg
http://www.ams.org/samplings/feature-column/fcarc-image-compression
http://upload.wikimedia.org/wikipedia/commons/2/23/Dctjpeg.png

Bec Brown : http://finda.photo/image/6954
Taylor Swayze : http://finda.photo/image/8420
Ariana Prestes : http://finda.photo/image/4937


    </textarea>
    <script src="./js/remark-latest.min.js"></script>
    <script>
      var slideshow = remark.create();

      // remove basic reveal styles
      (function($) {
        var head = $('head')[0];
        var style = $('head style[title=remark]')[0];
        head.removeChild(style);
      })(document.querySelectorAll.bind(document));
    </script>
  </body>

</html>
